# The UC3 app â€“ FlameSpray

## UC3 Introduction and Background

## UC3 System User Guide

This guide will walk you through the process of using the UC3 system, from installing AiiDA to running applications.

### Section 1: Installation and Setup

To start, you'll need to install AiiDA and set up the system. The following figures illustrate the steps you should follow.

![AiiDAlab homescreen](../_static/img/ucs/uc3/homescreen.png)

_The AiiDAlab homescreen_

The next step is to select and upload your SSH key.

![SSH key selection](../_static/img/ucs/uc3/Install_pt1.png)

_Selecting the SSH key_

Finally, you'll need to install AiiDA and set up the system.

![AiiDA installation and setup](../_static/img/ucs/uc3/Install_pt2.png)

_Installing AiiDA and setting up the system_

### Section 2: Running Application 1

Running Application 1 involves selecting the code and computer, inputting parameters, confirming the inputs and sending the UUID via email, and finally viewing the results.

![Selecting code and computer](../_static/img/ucs/uc3/Ap1_pt1.png)

_Selecting the code and computer for Application 1_

Next, select the inputs for the calculation.

![Input selection](../_static/img/ucs/uc3/Ap1_pt2.png)

_Selecting inputs for Application 1_

Confirm the inputs and make note of the UUID that you will need to email to the controller.

![Confirming inputs and UUID](../_static/img/ucs/uc3/Ap1_pt3.png)

_Confirming inputs and noting the UUID_

Monitoring the calculation.

![Viewing results](../_static/img/ucs/uc3/Ap1_pt4.png)

_Viewing results for Application 1 in JSON format_

Finally, view the results in JSON format.

![Viewing results](../_static/img/ucs/uc3/Ap1_pt5.png)

_Viewing results for Application 1 in JSON format_

### Section 3: Running Application 2

The steps for running Application 2 are similar to those for Application 1, but instead of a JSON output, you will receive a figure.

![Viewing results for Application 2](../_static/img/ucs/uc3/Ap2_pt5.png)

_Viewing results for Application 2_

### Section 4: Running Application 3

Finally, running Application 3 is almost identical to running Application 2. The following figure illustrates the results you should expect.

![Viewing results for Application 3](../_static/img/ucs/uc3/Ap3_pt5.png)

_Viewing results for Application 3_

## UC3 System Implementation Guide

The UC3 system provides a comprehensive interface for running Fluent software, allowing users to customize settings on a Marketplace frontend using an AiiDAlab instance. This document will guide you through the UC3 implementation process and its components.

The unique UUID (Universally Unique Identifier) generated for each request establishes a communication channel between the user and the HPC system, ensuring compliance with licensing agreements. The system operates with JSON format for both input and output files, located at `/home/aiidawork/<UUID>` in the Digital Ocean droplet instance. AiiDA orchestrates the workflow, data, and calculations within the system.

![UC3 system implementation diagram](../_static/img/ucs/uc3/schematic_of_system_implementation.png)

_UC3 system implementation diagram. A user sets parameters through an AiiDAlab instance on the marketplace frontend. The frontend generates an input file with user settings and a UUID for the job. Input data is sent to a Digital Ocean droplet via ssh. The user provides the UUID to a SINTEF controller, who initiates the job while adhering to licensing. A SINTEF bash script (\_submit.sh) uses the UUID to fetch inputs, run Fluent, and return results via ssh. The wait_watch.sh script, activated by AiiDA, monitors progress and retrieves output. AiiDA manages the UC3 workflow, data, and calculations. JSON files are in the /home/aiidawork/<UUID> on the droplet instance._

### System Components

The UC3 system comprises four main components:

1. **Client-facing frontend on Marketplace:** The AiiDAlab instance allows for user input, and a dummy AiiDA calculation job generates an input file and monitors output results.

2. **Data server (Digital Ocean droplet):** This server stores input files and outputs. Communication with the frontend happens via ssh. JSON input and output files are placed at `/home/aiidawork/<UUID>` in the droplet instance. The `wait_watch.sh` script, invoked by AiiDA, monitors calculation progress and retrieves the output file upon generation.

3. **HPC cluster (SINTEF):** Fluent calculations are executed based on user inputs provided in the input files generated by the frontend. Essential scripts and tools used on the HPC side include:

   - `_submit.sh`: Submits the job to the HPC cluster, runs Fluent calculations, and handles file transfers.
   - `flame_spray_launcher.sh`: Launches the job for the flame spray application.
   - `uc3wrapper.py`: Generates a Fluent input file based on user inputs.
   - `uc3_parser.py`: Parses Fluent calculation results into the output JSON file.

4. **Human controller:** A SINTEF employee who initiates calculations to comply with licensing agreements. Users manually send the UUID via email to the controller to start the job on the SINTEF side.

### Input File Format

The input file for the UC3 system is in JSON format, containing the following keys and corresponding user inputs (for application 1):

```json
{
  "ATSBcons": "<ATSB Concentration (mol/l)>",
  "Precurfr": "<Precursor Volume Flow Rate (ml/min)>",
  "Dispfr": "<Dispersion Volume Flow Rate (l/min)>",
  "Pilotch4fr": "<Pilot Methane Volume Flow Rate (l/min)>",
  "Piloto2fr": "<Pilot Oxygen Volume Flow Rate (l/min)>"
}
```

### Output File Format

The output file from the UC3 system is also in JSON format. It includes the following data (for application 1):

```json
{
  "area_flux": "<area_flux value>",
  "volume_flux": "<volume_flux value>",
  "particle_size": "<particle_size value>"
}
```

These parameters provide essential information for analyzing and optimizing the spray characteristics of flame spray processes.
